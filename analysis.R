
### (1) Loading the required R packages ------------------------------------ ###

library(RCurl)
library(XML)
# library(stringr)

### (2) Grabbing information from the web page ----------------------------- ###

# url <- "http://www.letpub.com.cn/index.php?journalid=15&page=journalapp&view=detail"
# url <- "http://www.letpub.com.cn/index.php?journalid=18&page=journalapp&view=detail"
url <- "http://www.letpub.com.cn/index.php?journalid=3320&page=journalapp&view=detail"

# MCP with 2022s
url <- "http://www.letpub.com.cn/index.php?journalid=5931&page=journalapp&view=detail"
cont <- getURL(url)

# Extracting the journal name. 
con.tree <- htmlTreeParse(cont)
doc <- con.tree$children$html
# node <- getNodeSet(doc, "//div[@id='link_list']")
node <- getNodeSet(doc, "//div[@id='link_list']/a")
content <- sapply(node, xmlValue)[3]
content <- gsub(" ??????", "", content)
content
# Extracting other items. 
tabs <- readHTMLTable(cont)
inf.tab <- tabs[[4]]

# ??????ISSN
# E-ISSN
# 2022-2023??????????????????
# ??????????????????
# 2022-2023????????? 
# ??????????????????
# h-index
# CiteScore
# ??????????????????
# ??????????????????
# ??????OA????????????
# ?????????
# ?????????????????????
# ????????????
# ????????????
# ????????????
# ????????????
# Gold OA????????????
# WOS??????SCI?????? ( 2022-2023????????????)
# ?????????SCI????????????( 2022???12??????????????????)

loc.22s <- grep("2022???12??????????????????", inf.tab$V1)
loc.21j <- grep("2021???12????????????", inf.tab$V1)
loc.21s <- grep("2021???12????????????", inf.tab$V1)
loc.20s <- grep("2020???12??????????????????", inf.tab$V1)

#. grep("????????????", inf.tab$V2)
#. grep("????????????", inf.tab$V2)

# IF????????????:????????????,????????????
fenqu.2022s <- tabs[[8]]
fenqu.2021j <- tabs[[10]]
fenqu.2021s <- tabs[[12]]
fenqu.2020s <- tabs[[14]]
DT::datatable(fenqu.2020s) # ?????????????????????“????????????”??????

if.item <- c("?????????", 
             "2022?????????????????????", "2022??????????????????", 
             "2022?????????????????????", "2022??????????????????", 
             "2022???????????????Top", "2022???????????????????????????", 
             "2021?????????????????????", "2021??????????????????", 
             "2021?????????????????????", "2021??????????????????", 
             "2021???????????????Top", "2021???????????????????????????", 
             "2021?????????????????????", "2021??????????????????", 
             "2021?????????????????????", "2021??????????????????", 
             "2021???????????????Top", "2021???????????????????????????",  
             "2020?????????????????????", "2020??????????????????", 
             "2020?????????????????????", "2020??????????????????", 
             "2020???????????????Top", "2020???????????????????????????")

j.name <- content
# for fenqu.2022s
s.2022.d <- strsplit(fenqu.2022s[1, 1], " ")[[1]][1]
s.2022.df <- substr(strsplit(fenqu.2022s[1, 1], " ")[[1]][2], 
                   start = 3, 
                   stop = 4)
s.2022.x <- paste(fenqu.2022s[-1, 1], collapse = "; ")
s.2022.xf <- paste(substr(fenqu.2022s[-1, 2], 
                          start = 5, 
                          stop = 6), 
                   collapse = "; ")
s.2022.top <- fenqu.2022s[1, 3]
s.2022.rev <- fenqu.2022s[1, 4]

# for fenqu.2021j
s.2021j.d <- strsplit(fenqu.2021j[1, 1], " ")[[1]][1]
s.2021j.df <- substr(strsplit(fenqu.2021j[1, 1], " ")[[1]][2], 
                    start = 3, 
                    stop = 4)
s.2021j.x <- paste(fenqu.2021j[-1, 1], collapse = "; ")
s.2021j.xf <- paste(substr(fenqu.2021j[-1, 2], 
                          start = 5, 
                          stop = 6), 
                   collapse = "; ")
s.2021j.top <- fenqu.2021j[1, 3]
s.2021j.rev <- fenqu.2021j[1, 4]

# for fenqu.2021s
s.2021s.d <- strsplit(fenqu.2021s[1, 1], " ")[[1]][1]
s.2021s.df <- substr(strsplit(fenqu.2021s[1, 1], " ")[[1]][2], 
                     start = 3, 
                     stop = 4)
s.2021s.x <- paste(fenqu.2021s[-1, 1], collapse = "; ")
s.2021s.xf <- paste(substr(fenqu.2021s[-1, 2], 
                           start = 5, 
                           stop = 6), 
                    collapse = "; ")
s.2021s.top <- fenqu.2021s[1, 3]
s.2021s.rev <- fenqu.2021s[1, 4]

# for fenqu.2020s
s.2020.d <- strsplit(fenqu.2020s[1, 1], " ")[[1]][1]
s.2020.df <- substr(strsplit(fenqu.2020s[1, 1], " ")[[1]][2], 
                     start = 3, 
                     stop = 4)
s.2020.x <- paste(fenqu.2020s[-1, 1], collapse = "; ")
s.2020.xf <- paste(substr(fenqu.2020s[-1, 2], 
                           start = 5, 
                           stop = 6), 
                    collapse = "; ")
s.2020.top <- fenqu.2020s[1, 3]
s.2020.rev <- fenqu.2020s[1, 4]

j.result <- c(j.name, 
              s.2022.d, s.2022.df, 
              s.2022.x, s.2022.xf, 
              s.2022.top, s.2022.rev, 
              s.2021j.d, s.2021j.df, 
              s.2021j.x, s.2021j.xf, 
              s.2021j.top, s.2021j.rev,
              s.2021s.d, s.2021s.df, 
              s.2021s.x, s.2021s.xf, 
              s.2021s.top, s.2021s.rev,
              s.2020.d, s.2020.df, 
              s.2020.x, s.2020.xf, 
              s.2020.top, s.2020.rev)
